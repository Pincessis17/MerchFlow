{% extends "base.html" %}
{% set title = "Dashboard" %}

{% block content %}
  <div class="page-title">Dashboard</div>

  <!-- Top metric cards -->
  <div class="grid cards-4">
    <div class="card">
      <div class="card-head">
        <div class="card-title">
          <div class="icon">ðŸ’°</div>
          Total Revenue
        </div>
        <span class="badge good">â–²</span>
      </div>
      <div class="metric">{{ "%.2f"|format(total_sales_value or 0) }}</div>
      <div class="sub">All time sales revenue</div>
    </div>

    <div class="card">
      <div class="card-head">
        <div class="card-title">
          <div class="icon">ðŸ›’</div>
          Today's Sales
        </div>
        <span class="badge">{{ today_sales_count or 0 }} sales</span>
      </div>
      <div class="metric">{{ "%.2f"|format(today_sales_total or 0) }}</div>
      <div class="sub">Todayâ€™s sales amount</div>
    </div>

    <div class="card">
      <div class="card-head">
        <div class="card-title">
          <div class="icon">ðŸ“¦</div>
          Total Products
        </div>
      </div>
      <div class="metric">{{ total_products or 0 }}</div>
      <div class="sub">Active SKUs</div>
    </div>

    <div class="card">
      <div class="card-head">
        <div class="card-title">
          <div class="icon">ðŸ§¾</div>
          Items in Stock
        </div>
      </div>
      <div class="metric">{{ total_stock or 0 }}</div>
      <div class="sub">Total physical quantity</div>
    </div>
  </div>

  <div style="height:14px;"></div>

  <!-- Main panels (trend + top selling) -->
  <div class="grid main-2">
    <div class="card panel">
      <div class="card-head">
        <div class="card-title" style="color: rgba(255,255,255,.86); font-weight:800;">
          Sales Trend <span style="color: var(--muted); font-weight:600;">(Last 7 Days)</span>
        </div>
        <span class="badge">Sales</span>
      </div>

      <!-- simple SVG placeholder chart (we'll wire real values next) -->
      <svg class="chart" viewBox="0 0 600 160" preserveAspectRatio="none">
        <!-- grid -->
        <g opacity="0.25" stroke="white">
          <line x1="0" y1="40" x2="600" y2="40"></line>
          <line x1="0" y1="80" x2="600" y2="80"></line>
          <line x1="0" y1="120" x2="600" y2="120"></line>
        </g>
        <!-- line -->
        <path d="M 20 130 L 110 120 L 200 118 L 290 105 L 380 108 L 470 96 L 580 92"
              fill="none" stroke="rgba(36,161,96,.92)" stroke-width="3" />
        <!-- points -->
        <g fill="rgba(232,177,43,.95)">
          <circle cx="20" cy="130" r="4"></circle>
          <circle cx="110" cy="120" r="4"></circle>
          <circle cx="200" cy="118" r="4"></circle>
          <circle cx="290" cy="105" r="4"></circle>
          <circle cx="380" cy="108" r="4"></circle>
          <circle cx="470" cy="96" r="4"></circle>
          <circle cx="580" cy="92" r="4"></circle>
        </g>
      </svg>

      <div class="sub" style="margin-top:10px;">
        Next: weâ€™ll render this using real 7-day totals from the database.
      </div>
    </div>

    <div class="card panel">
      <div class="card-head">
        <div class="card-title" style="color: rgba(255,255,255,.86); font-weight:800;">
          Top Selling Products
        </div>
        <span class="badge">Top 5</span>
      </div>

      {% if top_selling and top_selling|length %}
        <table class="table">
          <thead>
            <tr>
              <th>Product</th>
              <th style="text-align:right;">Qty</th>
              <th style="text-align:right;">Revenue</th>
            </tr>
          </thead>
          <tbody>
            {% for row in top_selling %}
              <tr>
                <td>{{ row.name }}</td>
                <td style="text-align:right;">{{ row.qty }}</td>
                <td style="text-align:right;">{{ "%.2f"|format(row.revenue) }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      {% else %}
        <div class="sub" style="margin-top:10px;">No data available.</div>
      {% endif %}
    </div>
  </div>

  <div style="height:14px;"></div>

  <!-- Alerts row -->
  <div class="grid alerts-3">
    <div class="card smallpanel">
      <div class="card-head">
        <div class="card-title" style="color: rgba(255,255,255,.86); font-weight:800;">
          Alerts
        </div>
        <span class="badge warn">!</span>
      </div>
      <div class="sub">
        Low stock products: <b>{{ low_stock_products|length }}</b>
      </div>
    </div>

    <div class="card smallpanel">
      <div class="card-head">
        <div class="card-title" style="color: rgba(255,255,255,.86); font-weight:800;">
          Expiring Soon
        </div>
        <span class="badge warn">{{ expiring_soon|length }}</span>
      </div>
      <div class="sub">Next {{ days_ahead }} days</div>
    </div>

    <div class="card smallpanel">
      <div class="card-head">
        <div class="card-title" style="color: rgba(255,255,255,.86); font-weight:800;">
          Expired
        </div>
        <span class="badge bad">{{ expired|length }}</span>
      </div>
      <div class="sub">Already expired products</div>
    </div>
  </div>

  <div class="actions">
    <a class="btn primary" href="{{ url_for('sales.sales_home') }}">ï¼‹ New Sale</a>
    <a class="btn" href="{{ url_for('inventory.inventory_home') }}">ï¼‹ Add Product</a>
    <a class="btn" href="{{ url_for('financial.financial_home') }}">ï¼‹ Record Expense</a>
    <a class="btn" href="{{ url_for('financial.financial_home') }}">ï¼‹ Receive Stock</a>
  </div>
{% endblock %}
