{% extends "layout.html" %}

{% block title %}Inventory - Pharmacy App{% endblock %}

{% block content %}
<h2>Inventory</h2>

<h3>Current Products</h3>

{# Low stock alert box #}
{% if low_stock %}
  <div style="border: 1px solid #f97316; background: #fff7ed; padding: 10px; margin-bottom: 16px;">
    <strong>Low stock alert</strong> – these items have quantity ≤ {{ low_stock_threshold }}:
    <ul>
      {% for p in low_stock %}
        <li>{{ p.name }} — {{ p.quantity }} {{ p.unit or "" }}</li>
      {% endfor %}
    </ul>
  </div>
{% endif %}

{% if products %}
  <table border="1" cellpadding="5">
    <tr>
      <th>#</th>
      <th>Product Name</th>
      <th>Quantity</th>
      <th>Unit</th>
      <th>Category</th>
      <th>Expiry Date</th>
      <th>Selling Price</th>
      <th>Actions</th>
    </tr>
    {% for p in products %}
    <tr>
      <td>{{ loop.index }}</td>
      <td>{{ p.name }}</td>
      <td>{{ p.quantity }}</td>
      <td>{{ p.unit or "" }}</td>
      <td>{{ p.category or "" }}</td>
      <td>{{ p.expiry_date or "-" }}</td>
      <td>{{ "%.2f" | format(p.price or 0) }}</td>
      <td>
        <a href="{{ url_for('inventory.edit_product', product_id=p.id) }}">Edit</a> |
        <a href="{{ url_for('inventory.delete_product', product_id=p.id) }}">Delete</a>
      </td>
    </tr>
    {% endfor %}
  </table>
{% else %}
  <p>No products yet. Add one below.</p>
{% endif %}

<hr>

<h3>Add New Product</h3>
<form method="POST">
  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
  <div>
    <label for="name">Product Name</label><br>
    <input type="text" id="name" name="name" required>
  </div>
  <br>

  <div>
    <label for="quantity">Quantity</label><br>
    <input type="number" id="quantity" name="quantity" min="0">
  </div>
  <br>

  <div>
    <label for="unit">Unit (e.g. BTL, TAB, PK)</label><br>
    <input type="text" id="unit" name="unit">
  </div>
  <br>

  <div>
    <label for="category">Category (e.g. Syrup, Antibiotic)</label><br>
    <input type="text" id="category" name="category">
  </div>
  <br>

  <div>
    <label for="expiry_date">Expiry Date</label><br>
    <input type="date" id="expiry_date" name="expiry_date">
  </div>
  <br>

  <div>
    <label for="price">Selling Price</label><br>
    <input type="number" step="0.01" id="price" name="price" min="0">
  </div>
  <br>

  <button type="submit">Add Product</button>
</form>
{% endblock %}
