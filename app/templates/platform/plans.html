{% extends "platform/base.html" %}
{% block content %}
  <div class="grid" style="grid-template-columns: 1fr 1.2fr;">
    <div class="card">
      <h2>Create Subscription Plan</h2>
      <form method="post">
        <input type="hidden" name="_csrf_token" value="{{ csrf_token() }}">
        <label>Plan Code</label>
        <input name="code" required placeholder="starter">

        <label>Plan Name</label>
        <input name="name" required placeholder="Starter">

        <label>Monthly Price</label>
        <input name="monthly_price" type="number" step="0.01" min="0" value="0">

        <label>Yearly Price (optional)</label>
        <input name="yearly_price" type="number" step="0.01" min="0">

        <label>Max Users (optional)</label>
        <input name="max_users" type="number" min="1">

        <button class="btn" type="submit">Create Plan</button>
      </form>
    </div>

    <div class="card">
      <h2>Subscription Plans</h2>
      {% if plans %}
        <table>
          <tr>
            <th>Code</th>
            <th>Name</th>
            <th>Monthly</th>
            <th>Yearly</th>
            <th>Max Users</th>
            <th>Status</th>
            <th>Action</th>
          </tr>
          {% for plan in plans %}
            <tr>
              <td>{{ plan.code }}</td>
              <td>{{ plan.name }}</td>
              <td>{{ "%.2f"|format(plan.monthly_price or 0) }}</td>
              <td>{{ "%.2f"|format(plan.yearly_price or 0) if plan.yearly_price is not none else "-" }}</td>
              <td>{{ plan.max_users or "-" }}</td>
              <td>{{ "Active" if plan.is_active else "Disabled" }}</td>
              <td>
                <form method="post" action="{{ url_for('platform.toggle_plan', plan_id=plan.id) }}">
                  <input type="hidden" name="_csrf_token" value="{{ csrf_token() }}">
                  <button class="btn" type="submit">{{ "Disable" if plan.is_active else "Enable" }}</button>
                </form>
              </td>
            </tr>
          {% endfor %}
        </table>
      {% else %}
        <p class="muted">No plans yet.</p>
      {% endif %}
    </div>
  </div>
{% endblock %}
