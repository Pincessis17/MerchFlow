{% extends "platform/base.html" %}

{% block topbar_actions %}
<div style="position: relative;">
  <svg style="position: absolute; left: 10px; top: 10px; color: #9CA3AF;" width="16" height="16" fill="none"
    stroke="currentColor" viewBox="0 0 24 24">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
      d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
  </svg>
  <input type="text" placeholder="Quick search..."
    style="padding-left: 32px; width: 250px; background: #F8FAFC; border: 1px solid var(--line); border-radius: 6px; padding-top: 8px; padding-bottom: 8px;">
</div>
<div style="display: flex; gap: 8px;">
  <button class="btn" onclick="document.getElementById('tenant-modal').style.display='flex'">Add New Tenant</button>
</div>
{% endblock %}

{% block content %}
<div class="header"
  style="margin-bottom: 24px; display: flex; justify-content: space-between; align-items: flex-start;">
  <div>
    <h1 style="margin: 0 0 8px; font-size: 28px; color: #111827; letter-spacing: -0.02em;">Tenants Overview</h1>
    <p style="margin: 0; color: #64748B; font-size: 15px;">Manage your property residents, lease lifecycles, and
      financial records.</p>
  </div>
  <div style="display: flex; gap: 8px;">
    <a href="{{ url_for('platform.export_subscribers_csv') }}" class="btn btn-secondary">Export CSV</a>
    <form method="post" action="{{ url_for('platform.send_renewal_reminders') }}" style="margin: 0;">
      <input type="hidden" name="_csrf_token" value="{{ csrf_token() }}">
      <button class="btn btn-secondary" type="submit">Renewal Reminders</button>
    </form>
  </div>
</div>

<div class="grid cards" style="margin-bottom: 24px;">
  <div class="card" style="padding: 24px;">
    <div style="display: flex; justify-content: space-between; margin-bottom: 16px;">
      <div
        style="width: 40px; height: 40px; background: #EFF6FF; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: #3B82F6;">
        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z">
          </path>
        </svg>
      </div>
      <span
        style="background: #DCFCE7; color: #16A34A; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 600;">+12%</span>
    </div>
    <div class="muted">Total Tenants</div>
    <div class="metric">{{ "{:,}".format(total_tenants|default(0)) }}</div>
  </div>

  <div class="card" style="padding: 24px;">
    <div style="display: flex; justify-content: space-between; margin-bottom: 16px;">
      <div
        style="width: 40px; height: 40px; background: #ECFDF5; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: #10B981;">
        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
      </div>
      <span style="color: #64748B; font-size: 13px; font-weight: 500;">94.2%</span>
    </div>
    <div class="muted">Active Leases</div>
    <div class="metric">{{ "{:,}".format(active_leases|default(0)) }}</div>
  </div>

  <div class="card" style="padding: 24px;">
    <div style="display: flex; justify-content: space-between; margin-bottom: 16px;">
      <div
        style="width: 40px; height: 40px; background: #FFFBEB; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: #F59E0B;">
        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
        </svg>
      </div>
      <span style="color: #F59E0B; font-size: 12px; font-weight: 600;">Next 30d</span>
    </div>
    <div class="muted">Expiring Soon</div>
    <div class="metric">{{ "{:,}".format(expiring_soon|default(0)) }}</div>
  </div>

  <div class="card" style="padding: 24px;">
    <div style="display: flex; justify-content: space-between; margin-bottom: 16px;">
      <div
        style="width: 40px; height: 40px; background: #F3E8FF; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: #A855F7;">
        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z">
          </path>
        </svg>
      </div>
      <span
        style="background: #DCFCE7; color: #16A34A; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 600;">+$3.2k</span>
    </div>
    <div class="muted">Monthly Revenue</div>
    <div class="metric">${{ "{:,.0f}".format(monthly_revenue|default(0)) }}</div>
  </div>
</div>

<div class="card" style="padding: 0;">
  <div
    style="padding: 16px 24px; border-bottom: 1px solid var(--line); display: flex; justify-content: space-between; align-items: center;">
    <div style="display: flex; gap: 12px; align-items: center;">
      <select
        style="width: 140px; padding: 8px 12px; background: #F8FAFC; border: 1px solid transparent; color: #475569; font-weight: 500;">
        <option>Lease Status</option>
      </select>
      <select
        style="width: 140px; padding: 8px 12px; background: #F8FAFC; border: 1px solid transparent; color: #475569; font-weight: 500;">
        <option>Property Type</option>
      </select>
      <a href="#"
        style="color: var(--accent); font-size: 14px; font-weight: 500; text-decoration: none; margin-left: 8px;">Clear
        all filters</a>
    </div>
    <div style="color: #64748B; font-size: 14px;">
      Showing 1-{{ tenant_rows|length }} of {{ "{:,}".format(total_tenants|default(0)) }} tenants
    </div>
  </div>

  <div style="overflow-x: auto;">
    <table style="margin: 0; min-width: 900px;">
      <thead>
        <tr>
          <th style="padding-left: 24px;">TENANT NAME</th>
          <th>PROPERTY ADDRESS</th>
          <th>STATUS</th>
          <th>PAYMENT HISTORY</th>
          <th>CONTACT INFO</th>
          <th style="text-align: right; padding-right: 24px;">ACTIONS</th>
        </tr>
      </thead>
      <tbody>
        {% if tenant_rows %}
        {% for row in tenant_rows %}
        {% set c = row.company %}
        <tr class="tenant-row">
          <td style="padding-left: 24px;">
            <div style="display: flex; align-items: center; gap: 12px;">
              {% if c.name == 'John Cooper' %}
              <img src="https://ui-avatars.com/api/?name=John+Cooper&background=random"
                style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;" alt="John Cooper">
              {% elif c.name == 'Sarah Jenkins' %}
              <img src="https://ui-avatars.com/api/?name=Sarah+Jenkins&background=random"
                style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;" alt="Sarah Jenkins">
              {% elif c.name == 'Marcus Vane' %}
              <img src="https://ui-avatars.com/api/?name=Marcus+Vane&background=random"
                style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;" alt="Marcus Vane">
              {% else %}
              <div
                style="width: 40px; height: 40px; border-radius: 50%; background: #E2E8F0; display: flex; justify-content: center; align-items: center; color: #475569; font-weight: bold;">
                {{ c.name[0] | upper }}
              </div>
              {% endif %}
              <div>
                <div style="color: #0F172A; font-weight: 600;">{{ c.name }}</div>
                <div style="color: #64748B; font-size: 12px;">Member since {{ c.created_at.strftime('%Y') }}</div>
              </div>
            </div>
          </td>
          <td style="line-height: 1.4;">
            {% if c.address %}
            {% set parts = c.address.split(', ') %}
            <div style="color: #334155; font-size: 14px;">{{ parts[0] }}</div>
            {% if parts|length > 1 %}
            <div style="color: #94A3B8; font-size: 13px;">{{ parts[1:]|join(', ') }}</div>
            {% endif %}
            {% else %}
            <div style="color: #334155; font-size: 14px;">No address</div>
            {% endif %}
          </td>
          <td>
            {% if c.status == 'active' %}
            <span
              style="background: var(--ok-bg); color: var(--ok); padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: 600;">Active</span>
            {% elif c.status == 'expiring' %}
            <span
              style="background: var(--warn-bg); color: #B45309; padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: 600;">Expiring</span>
            {% elif c.status == 'past due' %}
            <span
              style="background: var(--danger-bg); color: var(--danger); padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: 600;">Past
              Due</span>
            {% else %}
            <span
              style="background: #F1F5F9; color: #64748B; padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: 600;">{{
              c.status | title }}</span>
            {% endif %}
          </td>
          <td>
            <div style="display: flex; gap: 4px;">
              <div style="width: 8px; height: 8px; border-radius: 50%; background: var(--ok);"></div>
              <div style="width: 8px; height: 8px; border-radius: 50%; background: var(--ok);"></div>
              <div
                style="width: 8px; height: 8px; border-radius: 50%; background: {% if c.status == 'active' %}var(--ok){% else %}var(--warn){% endif %};">
              </div>
              <div
                style="width: 8px; height: 8px; border-radius: 50%; background: {% if c.status == 'past due' %}var(--danger){% elif c.status == 'active' %}var(--ok){% else %}#E2E8F0{% endif %};">
              </div>
            </div>
          </td>
          <td>
            <div
              style="display: flex; align-items: center; gap: 6px; color: #475569; font-size: 13px; margin-bottom: 2px;">
              <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z">
                </path>
              </svg>
              {{ c.email or 'N/A' }}
            </div>
            <div style="display: flex; align-items: center; gap: 6px; color: #94A3B8; font-size: 13px;">
              <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z">
                </path>
              </svg>
              {{ c.phone or '+1 (---) ---' }}
            </div>
          </td>
          <td style="text-align: right; padding-right: 24px;">
            <div style="display: flex; gap: 12px; justify-content: flex-end; color: #94A3B8;">
              <button class="icon-btn" title="View Details"
                style="border: none; background: transparent; cursor: pointer; color: inherit; padding: 0;">
                <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z">
                  </path>
                </svg>
              </button>
              <button class="icon-btn" title="Send Message"
                style="border: none; background: transparent; cursor: pointer; color: inherit; padding: 0;">
                <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z">
                  </path>
                </svg>
              </button>
              <button class="icon-btn" title="Edit Tenant"
                style="border: none; background: transparent; cursor: pointer; color: inherit; padding: 0;">
                <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z">
                  </path>
                </svg>
              </button>
            </div>
          </td>
        </tr>
        {% endfor %}
        {% else %}
        <tr>
          <td colspan="6" style="text-align: center; padding: 40px; color: #64748B;">No tenants found.</td>
        </tr>
        {% endif %}
      </tbody>
    </table>
  </div>

  <div
    style="padding: 16px 24px; border-top: 1px solid var(--line); display: flex; justify-content: space-between; align-items: center;">
    <button
      style="border: none; background: transparent; color: #94A3B8; font-weight: 500; font-size: 14px; cursor: pointer; display: flex; align-items: center; gap: 4px;">
      <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
      </svg>
      Previous
    </button>
    <div style="display: flex; gap: 4px;">
      <button
        style="width: 32px; height: 32px; border-radius: 6px; border: none; background: var(--accent); color: white; cursor: pointer; font-weight: 500;">1</button>
      <button
        style="width: 32px; height: 32px; border-radius: 6px; border: none; background: transparent; color: var(--text); cursor: pointer; font-weight: 500;">2</button>
      <button
        style="width: 32px; height: 32px; border-radius: 6px; border: none; background: transparent; color: var(--text); cursor: pointer; font-weight: 500;">3</button>
      <span style="display: flex; align-items: center; color: var(--text); padding: 0 4px;">...</span>
      <button
        style="width: 32px; height: 32px; border-radius: 6px; border: none; background: transparent; color: var(--text); cursor: pointer; font-weight: 500;">128</button>
    </div>
    <button
      style="border: none; background: transparent; color: #64748B; font-weight: 500; font-size: 14px; cursor: pointer; display: flex; align-items: center; gap: 4px;">
      Next
      <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
      </svg>
    </button>
  </div>
</div>

<!-- Modal Background & Content -->
<div id="tenant-modal"
  style="display: none; position: fixed; inset: 0; background: rgba(15, 23, 42, 0.4); z-index: 50; align-items: center; justify-content: center;">
  <div class="card" style="width: 100%; max-width: 600px; max-height: 90vh; overflow-y: auto; position: relative;">
    <button type="button" onclick="document.getElementById('tenant-modal').style.display='none'"
      style="position: absolute; right: 20px; top: 20px; border: none; background: transparent; font-size: 24px; color: #94A3B8; cursor: pointer;">&times;</button>
    <h2 style="margin-top: 0; color: #0F172A;">Add New Tenant</h2>
    <form method="post" action="{{ url_for('platform.create_tenant') }}" style="margin-top: 24px;">
      <input type="hidden" name="_csrf_token" value="{{ csrf_token() }}">
      <div class="form-grid">
        <div>
          <label style="display: block; font-size: 13px; font-weight: 500; color: #475569; margin-bottom: 6px;">Tenant
            Name</label>
          <input name="company_name" required placeholder="e.g. John Cooper">
        </div>
        <div>
          <label style="display: block; font-size: 13px; font-weight: 500; color: #475569; margin-bottom: 6px;">Email
            Address</label>
          <input name="company_email" type="email" placeholder="j.cooper@email.com">
        </div>
        <div style="grid-column: span 2;">
          <label style="display: block; font-size: 13px; font-weight: 500; color: #475569; margin-bottom: 6px;">Property
            Address</label>
          <input name="address" required placeholder="4512 Oakwood Dr, Apt 4B, Portland, OR 97201">
        </div>
        <div>
          <label style="display: block; font-size: 13px; font-weight: 500; color: #475569; margin-bottom: 6px;">Phone
            Number</label>
          <input name="phone" placeholder="+1 (503) 555-0129">
        </div>
        <div>
          <label
            style="display: block; font-size: 13px; font-weight: 500; color: #475569; margin-bottom: 6px;">Status</label>
          <select name="status">
            <option value="active">Active</option>
            <option value="expiring">Expiring</option>
            <option value="past due">Past Due</option>
          </select>
        </div>
      </div>
      <div style="margin-top: 24px; display: flex; justify-content: flex-end; gap: 12px;">
        <button type="button" class="btn btn-secondary"
          onclick="document.getElementById('tenant-modal').style.display='none'">Cancel</button>
        <button class="btn" type="submit">Create Tenant</button>
      </div>
    </form>
  </div>
</div>

<style>
  .tenant-row {
    transition: background-color 0.2s;
  }

  .tenant-row:hover {
    background-color: #F8FAFC;
    cursor: default;
  }

  .icon-btn {
    transition: color 0.2s;
  }

  .icon-btn:hover {
    color: var(--accent) !important;
  }
</style>
{% endblock %}