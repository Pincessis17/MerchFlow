{% extends "layout.html" %}

{% block title %}Purchases - Pharmacy App{% endblock %}

{% block content %}
<h2>Purchases</h2>

<p>
  <a href="{{ url_for('financial.financial_home') }}">‚Üê Back to Financial</a>
</p>

{% if not suppliers %}
  <p style="color:#b91c1c;">
    You must add at least 1 supplier before recording purchases.
    <a href="{{ url_for('financial.suppliers') }}">Add Supplier</a>
  </p>
{% endif %}

<h3>Record Purchase</h3>
<form method="POST" style="margin-bottom:16px;">
  <div>
    <label>Supplier</label><br>
    <select name="supplier_id" required>
      <option value="">-- Select supplier --</option>
      {% for s in suppliers %}
        <option value="{{ s.id }}">{{ s.name }}</option>
      {% endfor %}
    </select>
  </div>

  <div>
    <label>Product</label><br>
    <select name="product_id" required>
      <option value="">-- Select product --</option>
      {% for p in products %}
        <option value="{{ p.id }}">{{ p.name }}</option>
      {% endfor %}
    </select>
  </div>

  <div>
    <label>Quantity</label><br>
    <input type="number" name="quantity" min="1" required>
  </div>

  <div>
    <label>Buying price (per unit)</label><br>
    <input type="number" step="0.01" name="buying_price" min="0" required>
  </div>

  <button type="submit" {% if not suppliers %}disabled{% endif %}>
    Save Purchase
  </button>
</form>

<hr>

<h3>Recent Purchases</h3>
{% if recent_purchases %}
  <table border="1" cellpadding="5">
    <tr>
      <th>#</th>
      <th>Date/Time</th>
      <th>Supplier</th>
      <th>Product</th>
      <th>Qty</th>
      <th>Buying Price</th>
      <th>Total Cost</th>
    </tr>
    {% for pu in recent_purchases %}
      <tr>
        <td>{{ loop.index }}</td>
        <td>{{ pu.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
        <td>{{ pu.supplier.name }}</td>
        <td>{{ pu.product.name }}</td>
        <td>{{ pu.quantity }}</td>
        <td>{{ "%.2f"|format(pu.buying_price) }}</td>
        <td>{{ "%.2f"|format(pu.line_total) }}</td>
      </tr>
    {% endfor %}
  </table>
{% else %}
  <p>No purchases recorded yet.</p>
{% endif %}

{% endblock %}
